<!DOCTYPE html>
<html lang="en"><head><script src="/TIL_notes/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=TIL_notes/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A catalogue of notable things I have learnt">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.2/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="shortcut icon" href="http://localhost:1313/TIL_notes/favicon.ico">
    
    <link rel="stylesheet" href="/TIL_notes/css/style.min.css">

    <link rel="canonical" href="http://localhost:1313/TIL_notes/2024-12-06-the-requests-library-supports-automatic-retries-with-exponential-backoff/" />
    <title>The `requests` library supports automatic retries with exponential backoff </title>
</head>
<body>
        <div id="wrapper"><section class="hero is-medium is-link">
    <div class="hero-body">
        <div class="container has-text-centered">
            <h1 class="title">
                <i class="fas fa-laptop-code"></i> Benji
            </h1>
            <h2 class="subtitle">
                Lead Senior Software Engineer <a class="has-text-white is-underlined has-text-weight-bold" href="https://www.aveni.ai/" target="_blank">@Aveni.ai</a>
            </h2>
        </div>
    </div>
</section>

<article>
    <header id="post-header">
        <h1>The `requests` library supports automatic retries with exponential backoff </h1>
        <div>
                <time>December 6, 2024</time>
            </div>
    </header><p>The Python <code>requests</code> library can automatically retry failed HTTP requests with exponential backoff using urllib3&rsquo;s <code>Retry</code> class and a custom adapter.</p>
<p><strong>Implementation:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> requests.adapters <span style="color:#f92672">import</span> HTTPAdapter
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> urllib3.util <span style="color:#f92672">import</span> Retry
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Configure retry strategy</span>
</span></span><span style="display:flex;"><span>retries <span style="color:#f92672">=</span> Retry(
</span></span><span style="display:flex;"><span>    total<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>,                              <span style="color:#75715e"># Max retry attempts</span>
</span></span><span style="display:flex;"><span>    backoff_factor<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>,                     <span style="color:#75715e"># Wait time multiplier</span>
</span></span><span style="display:flex;"><span>    status_forcelist<span style="color:#f92672">=</span>[<span style="color:#ae81ff">500</span>, <span style="color:#ae81ff">502</span>, <span style="color:#ae81ff">503</span>, <span style="color:#ae81ff">504</span>] <span style="color:#75715e"># Retry on these status codes</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create adapter with retry configuration</span>
</span></span><span style="display:flex;"><span>adapter <span style="color:#f92672">=</span> HTTPAdapter(max_retries<span style="color:#f92672">=</span>retries)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Apply to session</span>
</span></span><span style="display:flex;"><span>session <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>Session()
</span></span><span style="display:flex;"><span>session<span style="color:#f92672">.</span>mount(<span style="color:#e6db74">&#39;https://&#39;</span>, adapter)
</span></span><span style="display:flex;"><span>session<span style="color:#f92672">.</span>mount(<span style="color:#e6db74">&#39;http://&#39;</span>, adapter)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Make requests through the session</span>
</span></span><span style="display:flex;"><span>response <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;https://api.example.com/endpoint&#34;</span>)
</span></span></code></pre></div><p><strong>How exponential backoff works:</strong></p>
<p>With <code>backoff_factor=3</code>, the wait time between retries increases exponentially:</p>
<ul>
<li>1st retry: wait 3 seconds</li>
<li>2nd retry: wait 6 seconds</li>
<li>3rd retry: wait 12 seconds</li>
</ul>
<p><strong>Key parameters:</strong></p>
<ul>
<li><code>total</code>: Maximum number of retry attempts</li>
<li><code>backoff_factor</code>: Multiplier for calculating wait time</li>
<li><code>status_forcelist</code>: HTTP status codes triggering retries (typically 500-level server errors)</li>
</ul>
<p><strong>Use cases:</strong></p>
<ul>
<li>Handling temporary server outages</li>
<li>Working with rate-limited APIs</li>
<li>Improving reliability for flaky network conditions</li>
<li>Dealing with overloaded services that return 503</li>
</ul>
<p>The session will automatically retry failed requests without additional code, making your HTTP clients more resilient to transient failures.</p>
<p><a href="https://dev.to/benji011/til-that-the-requests-library-supports-automatic-retries-with-exponential-backoff-2b6d">Original source</a></p>
</article>

        </div><footer class="footer">
    <div class="content has-text-centered">
        <p>
            <strong>Benjamin Lo</strong><br>
            Lead Senior Software Engineer<br>
            <a href="https://github.com/benji011">github.com/benji011</a>
        </p>
        <p>
            Â© <span id="current-year"></span> Benjamin Lo. All rights reserved.
        </p>
    </div>
    <script>
        document.getElementById('current-year').textContent = new Date().getFullYear();
    </script>
</footer>
</body>
</html>
